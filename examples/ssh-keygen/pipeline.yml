---
resource_types:
- name: smuggler
  type: docker-image
  source:
    repository: redfactorlabs/concourse-smuggler-resource
    tag: ubuntu-14.04

resources:
- name: ssh-keygen
  type: smuggler
  source:
    commands:
      check:
        path: sh
        args:
        - -e
        - -u
        - -c
        - |
          echo constant > ${SMUGGLER_OUTPUT_DIR}/versions
      in:
        path: sh
        args:
        - -e
        - -u
        - -c
        - |
          ssh-keygen -f ${SMUGGLER_DESTINATION_DIR}/${SMUGGLER_key_name} -N ''
          cat ${SMUGGLER_DESTINATION_DIR}/${SMUGGLER_key_name} |\
            shasum | cut -f 1 -d " " > ${SMUGGLER_OUTPUT_DIR}/versions

jobs:
- name: do_something_with_ssh
  serial: true
  plan:
  - get: ssh-keygen
    params:
      key_name: my_key
  - task: print-ssh-key
    config:
        platform: linux
        image: docker:///ubuntu
        inputs:
        - name: ssh-keygen
        run:
          path: sh
          args:
          - -e
          - -c
          - |
            cat ssh-keygen/my_key
            cat ssh-keygen/my_key.pub

